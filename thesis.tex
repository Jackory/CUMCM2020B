% !Mode:: "TeX:UTF-8"
% !TEX program  = xelatex

%\documentclass{cumcmthesis}
\documentclass[withoutpre]{cumcmthesis} %去掉封面与编号页
\usepackage[framemethod=TikZ]{mdframed}
\usepackage{url}   % 网页链接
\usepackage{subcaption} % 子标题
\title{穿越沙漠}
\tihao{A}
\baominghao{202010038016}
\schoolname{南京大学}
\membera{陈万驰 181840033 数学系}
\memberb{姜玉骅 181870080 工程管理学院}
\memberc{佘帅杰 181860077 计算机科学与技术系}
\supervisor{教练组}
\yearinput{2020}
\monthinput{08}
\dayinput{1}

\begin{document}

 \maketitle
 \begin{abstract}


\keywords{新冠肺炎疫情 \quad SEIR 模型 \quad 混样检测}
\end{abstract}


\section{问题重述与分析}
考虑如下的小游戏：玩家凭借一张地图，利用初始资金购买一定数量的水和食物（包括食品和其他日常用品），从起点出发，按照游戏规则在沙漠中行走。途中会遇到不同的天气，也可在矿山、村庄补充资金或资源，目标是在规定时间内到达终点，并保留尽可能多的资金。

1. 假设只有一名玩家，在整个游戏时段内每天天气状况事先全部已知。对于“第一关”和“第二关”地图，由于天气已知，所以玩家在游戏过程中应当始终向着某个特殊点（如终点、村庄、矿山）行走，而不会在中途因随机天气原因改变行程方向。所以将两张地图进行简化，只保留四种特殊点，并计算出各个点之间在一般情况下的最短距离（即不考虑沙暴天气，晴朗和高温天气都行走）。由此可以通过蒙特卡洛模拟计算出玩家的最佳策略。

2. 假设只有一名玩家，玩家仅知道当天的天气状况，可据此决定当天的行动方案。由于天气随机，所以需要讨论不同天气对玩家策略的影响。另外，是否位于矿山又是决定玩家决策的一个重要因素。所以我们基于这些因素给出玩家策略。利用附件中的“第一关”和“第二关”的天气数据，我们首先对天气概率进行估计，发现在沙漠中晴朗和高温天气占绝大部分时间，沙暴天气占少部分时间，由此可以以频率代替概率，得到三种天气出现的概率。然后利用随机生成数得到一组随机天气序列。在问题一的分析与模型的基础上，我们对给定的随机天气进行模拟，并最终得到玩家在“第三关”和“第四关”的合适的策略。

3.现有名玩家，他们有相同的初始资金，且同时从起点出发。若某天其中的任意名玩家均从区域A行走到区域B，则他们中的任一位消耗的资源数量均为基础消耗量的倍；若某天其中的任意名玩家在同一矿山挖矿，则他们中的任一位消耗的资源数量均为基础消耗量的倍，且每名玩家一天可通过挖矿获得的资金是基础收益的；若某天其中的任意名玩家在同一村庄购买资源，每箱价格均为基准价格的倍。其他情况下消耗资源数量与资源价格与单人游戏相同。

（1）假设在整个游戏时段内每天天气状况事先全部已知，每名玩家的行动方案需在第天确定且此后不能更改。对第五关地图进行简化与分析后，我们发现这一关的最佳路径是直接从起点出发前往终点，不前往矿山。从而该问题转化为二人选择完全相同的对称博弈问题。为解决此类问题，可以采用混合策略方法。因为游戏中第二天是高温天气，玩家可选择是否停留，由此有两种选择。利用蒙特卡洛模拟来预测玩家在两种选择下的四种路径的平均收益，得到满足Nash均衡的混合策略。

（2）假设所有玩家仅知道当天的天气状况，从第天起，每名玩家在当天行动结束后均知道其余玩家当天的行动方案和剩余的资源数量，随后确定各自第二天的行动方案。\\

\section{模型假设}
\begin{enumerate}
    \item 假设人群中所有个体都有被感染的概率。
    \item 假设被感染个体痊愈后，会产生抗体，不会再被感染。
    \item 假设所有感染者是同质的，即病情的严重程度、死亡率相同。
    \item 鉴于1月23日武汉市封城，假设武汉市总人口的不变。
    \item 假设核酸检测准确率为100\%。
    \item 假设混样检测的结果不会因混样而改变，即若至少有一人感染，混样检测呈阳性；若无人感染，混样检测呈阴性。
\end{enumerate}

\section{符号说明}
\begin{table}[H]
    \caption{符号说明表}\label{tab:001} \centering
    \begin{tabular}{ccc}
        \toprule[1.5pt]
        \textbf{参数} & \textbf{定义} & \textbf{单位}\\
        \midrule[1pt]
        $Weight$ & 负重上限 & 千克\\ 
        $Q$ & 初始资金 & 元 \\
        $t$ & 天数 & 天\\
        $T$ & 总天数 & 天\\
        $m_w$ & 每箱水的质量 & 千克/箱\\
        $m_f$ & 每箱食物的质量 & 千克/箱 \\
        $p_w$ & 水的基准价格 & 元/箱\\
        $p_f$ & 食物的基准价格 & 元/箱\\
        $n_{sw}$ & 晴朗天气下水的基准消耗量 & 箱\\
        $n_{hw}$ & 高温天气下水的基准消耗量 & 箱\\
        $n_{ow}$ & 沙暴天气下水的基准消耗量 & 箱\\
        $n_{sf}$ & 晴朗天气下食物的基准消耗量 & 箱\\
        $n_{hf}$ & 高温天气下食物的基准消耗量 & 箱\\
        $n_{of}$ & 沙暴天气下食物的基准消耗量 & 箱\\
        $n$ & 玩家数 & 人 \\
        $P_{t}$ & 第t天开始时玩家所处的位置 & / \\
        $W_{t}$ & 第t天开始时玩家剩余的水 & 箱 \\
        $F_{t}$ & 第t天开始时玩家剩余的食物 & 箱 \\ 
        $Q_{t}$ & 第t天开始时玩家剩余的资金 & 元 \\
        $S_{t}$ & 第t天玩家所处的地点特征 & /\\
        $Wea_t$ & 第t天的天气 & /\\
        $Q_{Mine}$ & 基础收益 & 元\\
        
        \bottomrule[1.5pt]
    \end{tabular}
\end{table}


\section{模型建立与求解}
\subsection{数学描述}

我们首先将该游戏利用数学语言加以描述。显然该局游戏的最终目的是使玩家到达终点时的收益最大，即\\\\
\begin{equation}
	\max Q_{30}+\frac{1}{2}p_wW_{30}+\frac{1}{2}p_fF_{30}
\end{equation}
其中$Q_{t},W_{t},F_{t}$分别表示第t天时玩家所剩下的资金、水和食物量。如果玩家在第30天前到达终点，则其各个属性将会在未来几天视作不变，所以我们以第三十天为统一结束时间。该目标函数有如下约束：\\\\
\begin{equation}
	Q_t=Q_{t-1}+Q_{Mine}Mine_t-Shop_t[2p_fShopF_t+2p_wShopW_t]
\end{equation}
其中$$Mine_t=\begin{cases}
0,\quad \text{如果第t天不挖矿}\\
1,\quad \text{如果第t天挖矿}
\end{cases}$$
$$Shop_t=\begin{cases}
0,\quad \text{如果第t天不购物}\\
1,\quad \text{如果第t天购物}
\end{cases}$$
即每天结束时的资金等于前一天的资金加上当天挖矿获得的1000元（如果挖矿的话），再减去在村庄购买食物和水花费的钱（如果购买的话）。其中$ShopF_t$和$ShopW_t$分别表示玩家在第t天购买的食物量和水量（如果购买的话）。\\\\
\begin{equation}
F_t=F_{t-1}-2Move_t\triangle F_t-3Mine_tMove_t\triangle F_t-(1-Move_t-Mine_t)\triangle F_t+Shop_tShopF_t
\end{equation}
即每天结束时的食物量等于前一天的食物量减去当天的食物消耗量再加上在村庄购买的食物量（如果购买的话）。\\\\
\begin{equation}
W_t=W_{t-1}-2Move_t\triangle W_t-3Mine_t\triangle W_t-(1-Move_t-Mine_t)\triangle W_t+Shop_tShopW_t
\end{equation}
即每天结束时的水量等于前一天的水量减去当天的水消耗量再加上在村庄购买的水量（如果购买的话）。\\\\
\begin{equation}
P_{t}=P_{t-1}(1-Move_t)+\bar{P}_{t-1}Move_t
\end{equation}
其中$P_t$表示第t天的位置，$\bar{P_t}$表示第t+1天可以到达的几个相邻区域之一，
$$Move_t=\begin{cases}
1,\quad \text{如果第t天移动}\\
0,\quad \text{如果第t天不移动（包括挖矿、停留）}
\end{cases}$$\\\\
\begin{equation}
Shop_t\leqslant If_0[(P_t-C_1)(P_t-C_2)\cdots(P_t-C_n)]
\end{equation}
\begin{equation}
Mine_t\leqslant If_0[(P_{t-1}-K_1)(P_{t-1}-K_2)\cdots(P_{t-1}-K_m)]
\end{equation}其中$C_1,C_2,\cdots,C_n$表示n个村庄的位置，$K_1,K_2,\cdots,K_m$表示m个矿山的位置，
$$If_0(x)=\begin{cases}
1,\quad if\quad x=0\\\\
0,\quad if\quad x\neq0
\end{cases}$$\\\\

$\triangle F$和$\triangle W$分别表示第t天基础消耗的食物量和水量，由Lagrange插值公式：
$$L(x)=\sum_{i=1}^nf(x_i)\displaystyle\frac{\Pi_{j\neq i}(x-x_j)}{\Pi_{j\neq i}(x_i-x_j)}$$
可得
\begin{equation}
\triangle F_t=n_{sf}\frac{Wea_t^2-3Wea_t+2}{2}+n_{hf}\frac{Wea_t^2-2Wea_t}{-1}+n_{of}\frac{Wea_t^2-Wea_t}{2}
\end{equation}
\begin{equation}
\triangle W_t=n_{sw}\frac{Wea_t^2-3Wea_t+2}{2}+n_{hw}\frac{Wea_t^2-2Wea_t}{-1}+n_{ow}\frac{Wea_t^2-Wea_t}{2}
\end{equation}
其中$$Wea_t=\begin{cases}
0,\quad\text{晴朗天气}\\
1,\quad\text{高温天气}\\
2,\quad\text{沙暴天气}
\end{cases}$$表示第t天的天气情况。


\subsection{地图简化}

我们首先引入Dijkstra算法，这是一种在有向赋权图中求两点之间最短路径的高效算法。
\begin{figure}[H]
	\centering
	\includegraphics[scale=0.7]{figures/Dijkstra.png}
	\caption{Dijkstra算法示意图}
	\label{fig:Dijkstra}
\end{figure}
如图\ref{fig:Dijkstra},该图中s是起点，最右侧的点是终点。$d(u)$表示从点$s$到点$u$的最短距离。之后执行如下操作：\\
(1)初始化$S={s},d(s)=0$;\\
(2)反复寻找未探索过的点v，使得$\min\quad\pi(v)$，将$v$添加到$S$中，并且$d(v)=\pi(v)$，其中
$$\pi(v)=\min_{e=(u,v):u\in S}d(u)+distance(arg\min_{e=(u,v):u\in S}d(u),v)$$
最终当终点属于$S$时，可以知道起点到终点的最短路径长度，从而问题求解。\\\\
可以看出，问题一的核心关键在于玩家是否前往矿山挖矿、在矿山连续挖几天矿、在挖矿之后是否需要前往村庄补给物资以及是否可以在矿山和村庄之间往返。我们将问题作如下简化：

选取图中起点、终点、村庄和矿山作为特殊点，利用Dijkstra算法计算出每两个特殊点之间的最短路径（即不考虑沙暴天气的影响下，所需最少的天数），如图\ref{fig:map1}所示。

该图是一个完全图（即图中每两点之间都有一条边），且每条边上的数字代表着两个特殊点之间的最短路径（受天气影响可能会有变化）。对于问题一，因为天气是预先给定的，整局游戏没有随机因素，所以我们假定玩家在游戏途中始终向着某个特殊点（终点、村庄、矿山）前进并且选择最合适的路径，而非漫无目的地随机移动，即游戏旅程由几条有向线段叠加而成：
\begin{equation}
	\overrightarrow{P}=\sum_{k=1}^{n}\overrightarrow{P_{i_k}P_{i_{k+1}}}
\end{equation}
其中$P_0,P_1,P_2,P_3$分别表示起点、村庄、矿山和终点，$i_k\leqslant3,\quad k=1,2,\dots,n$.
\begin{figure}[H]
	\centering
	\includegraphics[scale=0.4]{figures/map1newer.jpg}
	\caption{简化后的Map1}
	\label{fig:map1}
\end{figure}

\subsection{问题一}

\subsubsection{第一关}
问题一可简化为玩家在这几个特殊点之间的运动问题。由于第一关地图中村庄在由起点去往矿山的必经之路上，所以应该考虑在玩家第一次到达村庄时适量补充水和食物，然后前往矿山尽可能多地挖矿，在水和食物只够支撑玩家返回村庄时停止挖矿，选择返回村庄。在村庄补给一定量的水和食物（可以通过计算之后几天返回终点时的行程来确定需要购买的水和食物的量，以使得玩家到达终点时水和食物剩余量都为0，从而杜绝资产损失。）


我们将针对第一关的策略方案用流程图的形式展示出来,如图\ref{fig:map1lc}。
\begin{figure}[h]
	\centering
	\includegraphics[scale=0.4]{figures/map1liuchengtu}
	\caption{简化的第一关地图}
	\label{fig:map1lc}
\end{figure}
根据这样的流程图，我们进行问题分析和代码求解。玩家在游戏过程中的可选择性因素有：起点处的物资储备、在村庄的物资购买、在矿山挖矿的持续天数、返回村庄时的物资购买等。对此，我们对起点处的物资准备和在矿山挖矿的持续天数进行\textbf{有范围遍历}，对两次村庄物资购买分别采用精准计算的方法，借助Python编程语言求解。

其中，第一次到达村庄时购买物资的策略为：只购买水，且尽量让负重达到最大。即
\begin{equation}
	W_{buy1}=\min\{[\displaystyle \frac{Weight-m_wW_{c1}-m_fF_{c1}}{m_w}],\frac{Q_{c1}}{p_w}\}
\end{equation}
$Weight$为最大负重，$W_{c1}$为第一次到达村庄时剩余的水量，$F_{c1}$为第一次到达村庄时剩余的食物量，$m_w$和$m_f$分别表示一箱水和一箱食物的质量，$Q_{c1}$为第一次到达村庄时的剩余资金，$p_w$为一箱水的价格。\\

第二次到达村庄时购买物资的策略为：准确满足之后到达终点所需的全部水和食物，使得到达终点时不剩余任何水和食物。具体代码实现参见附件。\\

经过代码验证，最终找到最佳的策略方案，路径如图\ref{fig:map1word}所示。
\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{figures/map1word.jpg}
	\caption{第一关路径示意图}
	\label{fig:map1word}
\end{figure}

具体的游戏路径：经历8天时间到达村庄15（其中有2天沙暴天气，只能停在原地），当天在村庄购买水163箱。第二天立即前往矿山，第10天到达矿山，第11-17天进行挖矿，第18天停留在矿山。第19-20天前往村庄，并在第20天当天购买水36箱、食物40箱。第21-23天前往终点，最终于第23天到达终点，水和食物全部消耗完毕。最终剩余资金10430元。完整路径信息参见附件Result.xlsx。

\subsubsection{第二关}
第二关地图较第一关略复杂，包含两个矿山、两个村庄。简化的第二关地图包含6个结点，见图\cref{fig:map2}
\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{figures/map2.jpg}
	\caption{简化的第二关地图}
	\label{fig:map2}
\end{figure}
由于有范围的遍历算法仅仅适合超小规模图，对于第二关这样略微的图，很难寻找到最优解。因此我们采用蒙特卡罗方法对该图进行启发式搜索。启发式搜索过程中，玩家随机在图中进行状态转移，如玩家中途游戏失败则奖励值为0，若玩家在规定时间内成功抵达终点，则奖励值为玩家当前资产加所卖水和食物的钱。

玩家经过村庄尽可能的购买足够多的食物和水，在起点尽可能在不超重情况下购买食物，并保证能够抵达村庄中途补给。具体玩家所购买的食物和水，根据实际情况，进行适当调试以满足实际的搜索需求。

蒙特卡罗搜索所得结果见图





\subsection{问题二}


此时玩家仅仅知道当前的天气状况，可据此决定当天的行动方案，即行走或停留或挖矿，整体上的策略仍然分为两种，直接行走到终点或先到矿山挖矿再到终点。玩家可以根据当前天气状况，获取各个行动方案的未来收益，作以下讨论。
\begin{enumerate}
    \item 若玩家不在矿山：
    此时玩家需要决策行走或停留。
    \begin{enumerate}
        \item 沙暴天气必然停留。题目强制要求。
        \item 晴朗天气必然行走。晴朗天气行走消耗资源最少，若晴朗天气不行走，则不存在能够行走的天气状况。
        \item 高温天气需要根据地图参数条件决策。当前时刻为高温，假设下一时刻为晴朗。决策为行走的物资消耗为，水：$2n_{hw}$，食物：$2n_{hf}$。决策为停留等下一时刻晴天再行走的物资消耗为，水：$n_{hw} + 2n_{sw}$，食物：$n_{hf} + 2n_{sf}$。即满足：

        \begin{equation}
            \left\{
                \begin{array}{lr}
                    2n_{sw} < n_{hw}  
                    2n_{sf} < n_{hf}
                \end{array}
            \right.
            \label{equa:1}
        \end{equation}
        当前时刻停留的物资消耗更少，因此在时间宽裕的条件下可以考虑在高温天气停留一天。如果当前时刻为高温天气，下一时刻仍为高温天气，另做讨论。
    \end{enumerate}
    \item 若玩家在矿山：此时玩家需要决策行走或停留或挖矿
    \begin{enumerate}
        \item 晴朗天气必然挖矿。晴朗天气挖矿消耗资源最少，若晴朗天气不挖矿，则不存在应挖矿的天气
        \item 高温条件下需要根据地图参数条件决策。决策为挖矿的收益为：$Q_{mine} - 3(n_{hw}p_w + n_{hf}p_f)$，决策为停留的收益为：$-(n_{hw}p_w + n_{hf}p_f)$。即满足下列条件：
        \begin{equation}
            Q_{mine} > 2(n_{hw}p_w + n_{hf}p_f)
            \label{equa:2}
        \end{equation}
        则挖矿收益更高，因此决策为挖矿，否则考虑停留行走。其中$Q_mine$为挖矿基本收益，$n_{hw}$、$n{hf}$为高温下水、食物的基本消耗量。以上为考虑当前资源剩余量，若资源剩余量充足，考虑挖矿，若不足，则考虑行走。
        \item 沙暴天气需要根据地图参数条件决策。沙暴天气只能挖矿或停留。决策为挖矿的收益为：$Q_{mine} - 3(n_{ow}p_w + n_{of}p_f)$，决策为停留的收益为：$-(n_{ow}p_w + n_{of}p_f)$。若满足下列条件：
        \begin{equation}
            Q_{mine} < 2(n_{ow}p_w + n_{of}p_f)
            \label{equa:3}
        \end{equation}
        则挖矿收益，因此决策为挖矿，否则停留。其中$n_{ow}$、$n{of}$为沙暴天气下水、食物的基本消耗量。
    \end{enumerate}
\end{enumerate}
由于天气状况未知，因此本题通过蒙特卡罗模拟的方式，寻求玩家动态最佳决策的期望值。实际模拟中，假设每天天气状况相互独立，天气状况可根据第一关、第二关的天气的先验概率分布随机生成，即按2:3:1的概率随机生成晴朗、高温、沙暴三种天气状况。若地图条件满足式\cref{equa:1}，即当天为高温天气且下一天为晴朗时，当天选择停留消耗的资源更少。由于存在连续几天出现高温天气的可能性，所以高温天气选择停留可能会产生恶性循环。因此，我们以概率形式表示我们的决策，0.4的概率(下一天为晴天)选择停留，0.6的概率选择行走。

下面就三、四关作具体讨论：
\subsection{第三关}
第三关的地图不存在村庄，不存在沙暴天气。因此模型简化了许多。此时玩家路线仅需考虑是直接去终点，还是先经过矿山挖矿再到终点，如\cref{fig:map3}所示。
\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{figures/map3.jpg}
	\caption{简化后的Map3}
	\label{fig:map3}
\end{figure}

第三关地图满足式\cref{equa:1}，\cref{equa:2}，不满足\cref{equa:3}，即玩家的策略如下：
\begin{enumerate}
    \item 晴朗天气：在矿山则挖矿；不在矿山则行走
    \item 高温天气：在矿山不挖矿，0.4概率停留，0.6概率行走；不在矿山0.4概率停留，0.6概率行走。
\end{enumerate}

天气情况按2:3随机生成晴朗、高温。用蒙特卡罗分别对玩家直奔终点和先去矿山再去终点两种路线模拟1000轮，每次模拟100次，取最终资金最高的一次作为本轮最终资金。结果见\cref{fig:check3}
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{figures/check3.png}
    \caption{第三关蒙特卡罗模拟结果}
    \label{fig:check3}
\end{figure}
可见直接到终点的最佳预期资金稳定在9450元左右，先去矿山再去终点的预期最佳资金稳定在8100元上下。故第三关地图玩家的路线决策应为直奔终点。

\subsection{第四关}
第四关的地图有一个村庄、一个矿山且存在沙暴天气。模型较第三关复杂。由于起点到终点的距离等于起点到矿山的距离加上矿山到终点的距离，故玩家必然会挖矿。简化图如\cref{fig:map4}
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{figures/map4.jpg}
    \caption{简化后的Map4}
    \label{fig:map4}
\end{figure}

第四关地图不满足式\cref{equa:1}，\cref{equa:2}，满足式\cref{equa:3}。即玩家的策略如下：
\begin{enumerate}
    \item 晴朗天气：在矿山则挖矿；不在矿山则行走。
    \item 高温天气：在矿山则挖矿；不在矿山则以0.4概率停留，0.6概率行走。
    \item 沙暴天气：在矿山则挖矿；不在矿山只能停留。
\end{enumerate}
天气情况按2:3:1随机生成晴朗、高温和沙暴。用蒙特卡罗对玩家路线随机模拟1000轮，每轮模拟500次，取最终资金的最高的一次作为本轮的资金。结果见\cref{fig:check4}
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{figures/check4.png}
    \caption{第四关蒙特卡罗模拟结果}
    \label{fig:check4}
\end{figure}
可见由于天气带来的随机性，最佳预期资金平均值趋近于10800。
现对于一个表现较好的蒙特卡罗模拟例子作分析。随机生成的天气为[晴朗 , 高温,  高温 ,  高温 ,  晴朗 ,  晴朗 ,  高温 ,  高温 ,  高温 ,  晴朗 ,  高温 ,  晴朗 ,  高温 ,  高温 ,  晴朗 ,  沙暴 ,  沙暴 ,  高温 ,  沙暴 ,  高温 ,  沙暴 ,  沙暴 ,  高温 ,  沙暴 ,  高温 ,  晴朗 ,  沙暴 ,  晴朗 ,  高温 ,  高温]。该天气情况为事实生成的，玩家仍然仅知道当天的天气情况。针对该天气状况，玩家的最优动态策略路径：起点购买240箱水、240箱食物，第5天晚上到达矿山(其中经历沙暴延迟一天)，挖矿6天，第13天早上离开，并于16号早上到达终点，最终资金为12590。玩家详细路径如图：
\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{figures/map4path.jpg}
	\caption{一个最优决策路径的图例}
	\label{fig:map4path}
\end{figure}

由于天气因素的随机性以及玩家动态决策的随机性会导致玩家的最佳路径不同、最终资金不同。上述
蒙特卡罗例子只是某种特定情况下的，最佳路径，不具有典型代表性。该例子中，玩家不需要经过村庄是因为前期行走过程中天气以晴朗为主，消耗物资较少。若在其它天气情况下，可能需要经过村庄补给。

\section{问题三}
\subsection{第五关}
第五关的地图较为简单，可简化为如图\cref{fig:map5}所示，我们先从单人游戏开始分析。对该图分析可以发现，本关有两种路径：一是直接由起点奔向终点，一是从起点先到矿山，再到终点。第一种路径的最少花费是$(6\times2+18)\times5+(8\times2+18)\times10=150+340=490$。因为天数较少，路径结构较为简单，经过简单计算后发现在第五关地图中，最佳路径是从起点直奔终点，不经过矿山，这样只需实际行走三天。
\begin{figure}[H]
	\centering。
	\includegraphics[scale=0.5]{figures/map3.jpg}
	\caption{简化后的Map5}
	\label{fig:map5}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{figures/map5path}
	\caption{Map5的两种最优路径}	
\end{figure}
对于二人游戏，由于两名玩家都可以认为是“绝对自私，完全理智”的，所以可以采用静态博弈理论，即两个决策者都知道所有信息（即共同知识），两人同时做出决策，这样的博弈称为完全信息的静态博弈。在该博弈模型中，参与人是两名玩家，每个人的策略空间有两个元素（即是否在高温天停留），每个人的效用函数即是自己最终剩余资金的期望值。

游戏的博弈中参与人集合可以用$N={1,2}$表示，1表示玩家1，2表示玩家2。玩家1的可能的策略记作$a\in A={1,2}$，1、2分别表示选择第2天不停留和停留；玩家2的可能的策略记作$b\in B={1,2}$，1、2分别表示选择第2天不停留和停留。$A$和$B$分别是参与人1和2的策略空间。

对于两名玩家的每一个策略组合$(a,b)$，Map5中都有两种路径，且完全等价，所以我们用计算机进行蒙特卡洛模拟，来计算在该种策略组合下两名玩家的平均收益。用$P(a,b)$和$Q(a,b)$分别表示玩家1和玩家2一次游戏的期望收益，这可以作为玩家1和玩家2的效用函数。经计算得
\begin{equation}
	P=(p_{ij})_{2\times2}=\begin{pmatrix}
	8255.09&8419.88\\8567.58&8402.51
	\end{pmatrix}
\end{equation}
\begin{equation}
    Q=(q_{ij})_{2\times2}=\begin{pmatrix}
    8255.09&8567.44\\
    8420.16&8402.51
    \end{pmatrix}
\end{equation}
可以近似认为$$P=Q'$$

设玩家1采取策略$i$的概率为$p_i(i=1,2)$，玩家2采取策略$j$的概率为$q_j(j=1,2)$，记行向量$\mathbf{p}=(p_1,p_2),\mathbf{q}=(q_1,q_2)$，满足
$$0\leqslant p_i\leqslant1,\quad\sum_{i=1}^{2}p_i=1,\quad0\leqslant q_j\leqslant1,\quad\sum_{j=1}^{2}q_j=1$$
的概率向量分别构成玩家1和玩家2的混合策略空间。

按照混合策略下的Nash均衡理论，计算得
$p_1=q_1=0.346,\quad p_2=q_2=0.654$。
也即玩家1和玩家2应该以34.6\%的概率选择不停留，以65.4\%的概率选择停留。由于两名玩家是完全对称的，所以认为两人所采取的策略应当是完全相同的。我们用蒙特卡洛进行大量模拟两人的游戏过程，通过改变两人选择不停留的概率（两人始终保持概率相同），步长为0.001，最终得到个人的期望收益随概率的变化如图\ref{fig:shouyi}。
\begin{figure}[H]
	\centering
	\includegraphics[scale=0.4]{figures/shouyi}
	\caption{个人期望收益随停留概率变化曲线}
	\label{fig:shouyi}
\end{figure}
从图中可以看出，个人期望收益在概率接近0.35到达峰值，这也与我们计算的0.346概率高度吻合，所以可以说明通过混合策略的Nash均衡理论计算出的结果是较为准确可靠的。




\section{灵敏度分析}
在第三关、第四关模拟中，由于未知天气，原模型中假设晴朗、高温、沙暴天气出现比例为2:3:1，根据这一比例确定了第三关、第四关预期的最终资金。下面我们来分析晴朗、高温、沙暴天气出现比例对第三关、第四关最终资金的灵敏度。

\subsection{第三关}
我们设置5组晴朗、高温天气比例，E1：0.4:0.6；E2：0.45:0.55；E3: 0.5:0.5；E4：0.35:0.65；E5：0.3:0.7
分别用上述天气比例蒙特卡罗模拟第四关100轮，每轮100次，将每轮最终资金的最大值作为该轮的最终资金。分别得到从起点直接去终点的预期最终资金、从起点先到矿山再到终点的预期最终资金，结果见\cref{fig:analysis3map1}、\cref{fig:analysis3map2}。
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/analysis3map1.png}
    \caption{第三关：起点到终点预期最终资金}
    \label{fig:analysis3map1}
\end{figure}


\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/analysis3map2.png}
    \caption{第三关：起点到矿山再到终点预期最终资金}
    \label{fig:analysis3map2}
\end{figure}
观察发现，晴朗天气比例的降低或高温天气比例的增高，会导致最终资金的减少。这也正确反映了天气情况对玩家策略、资金的影响。但总的来说，仍然是从起点直接到终点的最终资金比从起点到终点再到矿山的高，验证了我们第三关的结果的正确性。

\subsection{第四关}
我们设置5组晴朗、高温、沙暴天气比例，E1：10:15:5；E2：8:17:5；E3: 12:13:5；E4：11:15:4；E5：11:16:3
分别用上述天气比例蒙特卡罗模拟第四关500轮，每轮500次，将每轮最终资金的最大值作为该轮的最终资金，结果见\cref{fig:analysis4}：
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/anaysis4.png}
    \caption{第四关预期最终资金}
    \label{fig:analysis4}
\end{figure}
观察发现，晴朗天气比例越高、高温和沙暴天气比例越低，会促使最终资金的增加，可见天气随机性对结果会有不小的影响，所以第四关玩家只知道当天的天气，意味着全局最优策略和最高资金也是随机的，与天气情况的随机性息息相关。这样的结果与我们的设想符合。

\subsection{第六关}
第六关是本题中难度最大的一关，不太可能使用前述算法将可能的情况遍历或模拟，我们用动态评估的方法给出在具体情况下的求解方法。

首先，我们在游戏开始之前，沿用前述方法对天气进行随机模拟，得到天气序列。然后我们使用计算机模拟玩家进行游戏。当玩家走到某一区域时，搜索与该区域相邻的区域作为下一天可采取的行动空间（包括购买物资、采矿等）。之后我们利用蒙特卡洛树搜索方法对这几个区域进行大量模拟，得出几个区域最终的期望收益。即
\begin{equation}
	\bar{Q}=\displaystyle\frac{\sum_{i=1}^{n}Q_i}{n}
\end{equation}

其中$\bar{Q}$表示某一区域的期望收益，$Q_i$表示第i次模拟的最终收益。由大数定律可知，当模拟次数足够大时，该区域的期望收益将会收敛于一个值，我们认为该值能代表该区域能给玩家带来的平均收益。所以玩家应在几个可选区域中选取期望收益最高的一个并在下一天执行。

我们以区域17为例来演示这一过程。如图\ref{fig:map6score}所示，区域17周围有四个区域，分别是12、16、18、22，红色数字是各个区域经过大量模拟得到的期望收益，其中16位玩家已走过的区域，12为另外两位玩家（在计算机模拟中固定他们的运动轨迹）要经过的区域，所以这两个区域的期望收益较低；而18是矿场，玩家可以在矿场开采矿石，所以期望收益较高，这也符合实际。最终玩家选择期望收益最高的18区域并在第二天前往到达。


\begin{figure}[H]
	\centering
	\includegraphics[scale=0.7]{figures/map6score}
	\caption{区域17期望收益计算过程示意图}
	\label{fig:map6score}
\end{figure}

如图\ref{fig:map6path}所示，我们事先给定两个机器人（橙色和蓝色）的行动方案，玩家（红色）在每一次行动过后得知机器人的行动方案，并基于这些信息以及前述的期望收益评估方法来规划第二天的行程。最终，玩家路径几乎完美的与其他两个机器人的路径错开。
\begin{figure}[H]
	\centering
	\includegraphics[scale=0.4]{figures/map6path}
	\caption{动态评估给出的玩家最优路径}
	\label{fig:map6path}
\end{figure}
%参考文献
\begin{thebibliography}{9}%宽度9

    

\end{thebibliography}

\end{document} 